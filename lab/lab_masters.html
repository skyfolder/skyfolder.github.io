<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab: Masters of Meteorology</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        .tab-btn.active { background-color: #4f46e5; color: white; border-color: #4f46e5; }
        canvas { touch-action: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen flex flex-col overflow-hidden">

    <nav class="bg-white border-b border-slate-200 h-14 flex-none flex items-center px-4 justify-between z-10">
        <a href="labs.html" class="flex items-center gap-2 text-slate-600 hover:text-indigo-600 font-bold transition-colors">
            <i class="fa-solid fa-arrow-left"></i> 랩 목록
        </a>
        <h1 class="font-black text-lg hidden md:block">Masters of Atmospheric Science</h1>
        <div class="w-20"></div>
    </nav>

    <div class="flex flex-1 overflow-hidden">
        <aside class="w-64 bg-white border-r border-slate-200 flex-none overflow-y-auto hidden md:block">
            <div class="p-4 space-y-2">
                <button onclick="switchTab('bjerknes')" id="btn-bjerknes" class="tab-btn active w-full text-left px-4 py-3 rounded-lg border border-transparent hover:bg-slate-50 transition-all font-medium text-sm flex items-center gap-3">
                    <i class="fa-solid fa-hurricane"></i> 야곱 비야크네스
                </button>
                <button onclick="switchTab('rossby')" id="btn-rossby" class="tab-btn w-full text-left px-4 py-3 rounded-lg border border-transparent hover:bg-slate-50 transition-all font-medium text-sm flex items-center gap-3">
                    <i class="fa-solid fa-wave-square"></i> 칼 구스타프 로스비
                </button>
                <button onclick="switchTab('walker')" id="btn-walker" class="tab-btn w-full text-left px-4 py-3 rounded-lg border border-transparent hover:bg-slate-50 transition-all font-medium text-sm flex items-center gap-3">
                    <i class="fa-solid fa-arrows-left-right-to-line"></i> 길버트 워커
                </button>
                <button onclick="switchTab('richardson')" id="btn-richardson" class="tab-btn w-full text-left px-4 py-3 rounded-lg border border-transparent hover:bg-slate-50 transition-all font-medium text-sm flex items-center gap-3">
                    <i class="fa-solid fa-calculator"></i> 루이스 리처드슨
                </button>
                <button onclick="switchTab('charney')" id="btn-charney" class="tab-btn w-full text-left px-4 py-3 rounded-lg border border-transparent hover:bg-slate-50 transition-all font-medium text-sm flex items-center gap-3">
                    <i class="fa-solid fa-chart-area"></i> 쥴 차니
                </button>
                <button onclick="switchTab('ferrel')" id="btn-ferrel" class="tab-btn w-full text-left px-4 py-3 rounded-lg border border-transparent hover:bg-slate-50 transition-all font-medium text-sm flex items-center gap-3">
                    <i class="fa-solid fa-earth-americas"></i> 윌리엄 페렐
                </button>
            </div>
        </aside>

        <main class="flex-1 overflow-y-auto bg-slate-50 p-4 md:p-8 relative">
            
            <div class="md:hidden mb-6">
                <select onchange="switchTab(this.value)" class="w-full p-3 rounded-lg border border-slate-300 bg-white font-bold">
                    <option value="bjerknes">야곱 비야크네스 (저기압 모델)</option>
                    <option value="rossby">칼 구스타프 로스비 (파동)</option>
                    <option value="walker">길버트 워커 (ENSO)</option>
                    <option value="richardson">루이스 리처드슨 (수치예보)</option>
                    <option value="charney">쥴 차니 (경압불안정)</option>
                    <option value="ferrel">윌리엄 페렐 (대기대순환)</option>
                </select>
            </div>

            <section id="tab-bjerknes" class="tab-content block max-w-4xl mx-auto">
                <header class="mb-6">
                    <span class="text-indigo-600 font-bold text-xs tracking-wider uppercase">Jacob Bjerknes</span>
                    <h2 class="text-3xl font-black text-slate-900 mt-1">노르웨이 저기압 모델</h2>
                    <p class="text-slate-600 mt-2">온대 저기압의 생애주기(Life Cycle)를 정립했습니다. 전선 이론의 창시자입니다.</p>
                </header>
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold">저기압 발달 단계 시뮬레이션</h3>
                        <div class="bg-slate-100 px-3 py-1 rounded text-xs font-mono" id="cyclone-stage-text">Stage: Wave</div>
                    </div>
                    <canvas id="bjerknesCanvas" width="600" height="400" class="w-full bg-slate-50 rounded-lg border border-slate-100 mb-6"></canvas>
                    <input type="range" id="cycloneSlider" min="0" max="100" value="30" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                    <div class="flex justify-between text-xs text-slate-400 mt-2 font-medium">
                        <span>정체전선</span>
                        <span>파동 형성</span>
                        <span>성숙 단계</span>
                        <span>폐색 단계</span>
                    </div>
                </div>
            </section>

            <section id="tab-rossby" class="tab-content hidden max-w-4xl mx-auto">
                <header class="mb-6">
                    <span class="text-indigo-600 font-bold text-xs tracking-wider uppercase">Carl-Gustav Rossby</span>
                    <h2 class="text-3xl font-black text-slate-900 mt-1">로스비 파동 (Rossby Waves)</h2>
                    <p class="text-slate-600 mt-2">행성 규모의 파동이 어떻게 움직이는지 설명했습니다. $$ c = U - \frac{\beta}{k^2} $$</p>
                </header>
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                    <canvas id="rossbyCanvas" width="600" height="400" class="w-full bg-slate-900 rounded-lg shadow-inner mb-6"></canvas>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 mb-1">파수 (Wave Number, n)</label>
                            <input type="range" id="rossbyN" min="1" max="8" step="1" value="4" class="w-full h-2 bg-slate-200 rounded-lg cursor-pointer accent-indigo-600">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 mb-1">진폭 (Amplitude)</label>
                            <input type="range" id="rossbyAmp" min="10" max="80" value="40" class="w-full h-2 bg-slate-200 rounded-lg cursor-pointer accent-indigo-600">
                        </div>
                    </div>
                </div>
            </section>

            <section id="tab-walker" class="tab-content hidden max-w-4xl mx-auto">
                <header class="mb-6">
                    <span class="text-indigo-600 font-bold text-xs tracking-wider uppercase">Gilbert Walker</span>
                    <h2 class="text-3xl font-black text-slate-900 mt-1">남방진동 (ENSO)</h2>
                    <p class="text-slate-600 mt-2">태평양 적도 부근의 대규모 동서 순환을 발견했습니다.</p>
                </header>
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                    <div class="flex gap-2 mb-6 justify-center">
                        <button onclick="setWalker('lanina')" class="px-4 py-2 text-sm font-bold rounded-full bg-blue-100 text-blue-700 hover:bg-blue-200 transition">라니냐 (La Niña)</button>
                        <button onclick="setWalker('neutral')" class="px-4 py-2 text-sm font-bold rounded-full bg-slate-100 text-slate-700 hover:bg-slate-200 transition">평상시 (Neutral)</button>
                        <button onclick="setWalker('elnino')" class="px-4 py-2 text-sm font-bold rounded-full bg-red-100 text-red-700 hover:bg-red-200 transition">엘니뇨 (El Niño)</button>
                    </div>
                    
                    <div class="relative h-64 bg-sky-100 rounded-xl overflow-hidden border border-sky-200 w-full">
                        <div class="absolute inset-0 z-10 pointer-events-none">
                            <div id="wind-arrows" class="absolute top-10 left-10 right-10 h-20 border-2 border-slate-400 border-dashed rounded-full opacity-50 transition-all duration-700"></div>
                            <div id="cloud-mass" class="absolute top-5 transition-all duration-700 text-6xl text-white drop-shadow-md">
                                <i class="fa-solid fa-cloud"></i>
                                <i class="fa-solid fa-cloud absolute -left-4 top-2 text-4xl"></i>
                            </div>
                        </div>
                        <div class="absolute bottom-0 w-full h-1/2 bg-blue-600 transition-all duration-700 flex items-end">
                            <div id="thermocline" class="w-full h-full bg-blue-800 origin-bottom transition-all duration-700" style="clip-path: polygon(0 20%, 100% 80%, 100% 100%, 0% 100%);"></div>
                        </div>
                        <span class="absolute bottom-2 left-4 text-white font-bold text-xs z-20">Indonesia (West)</span>
                        <span class="absolute bottom-2 right-4 text-white font-bold text-xs z-20">Peru (East)</span>
                    </div>
                    <p id="walker-desc" class="mt-4 text-center text-sm font-medium text-slate-600 bg-slate-50 p-3 rounded-lg">
                        버튼을 눌러 상태를 변경해보세요.
                    </p>
                </div>
            </section>

            <section id="tab-richardson" class="tab-content hidden max-w-4xl mx-auto">
                <header class="mb-6">
                    <span class="text-indigo-600 font-bold text-xs tracking-wider uppercase">Lewis Fry Richardson</span>
                    <h2 class="text-3xl font-black text-slate-900 mt-1">수치예보의 꿈</h2>
                    <p class="text-slate-600 mt-2">"Forecast Factory" - 지구를 격자로 나누어 계산하는 현대 기상 모델의 시초입니다.</p>
                </header>
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                    <div class="grid grid-cols-5 gap-1 mb-4" id="forecast-grid">
                        </div>
                    <button onclick="stepRichardson()" class="w-full bg-slate-800 text-white py-3 rounded-lg font-bold hover:bg-slate-700 transition flex items-center justify-center gap-2">
                        <i class="fa-solid fa-play"></i> 1단계 계산 (Time Step)
                    </button>
                    <p class="mt-3 text-xs text-slate-500 text-center">
                        각 격자는 주변 격자의 데이터를 받아 자신의 값을 갱신합니다. (유한차분법의 시각화)
                    </p>
                </div>
            </section>

            <section id="tab-charney" class="tab-content hidden max-w-4xl mx-auto">
                <header class="mb-6">
                    <span class="text-indigo-600 font-bold text-xs tracking-wider uppercase">Jule Charney</span>
                    <h2 class="text-3xl font-black text-slate-900 mt-1">경압 불안정</h2>
                    <p class="text-slate-600 mt-2">대규모 대기 파동이 발달하는 수학적 메커니즘을 규명했습니다.</p>
                </header>
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 flex flex-col items-center">
                    <div class="relative w-full h-64 bg-slate-50 border border-slate-200 rounded-lg overflow-hidden flex items-end justify-center">
                        <canvas id="charneyCanvas" width="600" height="250" class="absolute bottom-0"></canvas>
                    </div>
                    <div class="mt-4 text-center">
                        <h4 class="font-bold text-slate-700">Charney's Growth Rate Curve</h4>
                        <p class="text-xs text-slate-500 mt-1">특정 파장의 파동만이 불안정하여 급격히 성장합니다.</p>
                    </div>
                </div>
            </section>

            <section id="tab-ferrel" class="tab-content hidden max-w-4xl mx-auto">
                <header class="mb-6">
                    <span class="text-indigo-600 font-bold text-xs tracking-wider uppercase">William Ferrel</span>
                    <h2 class="text-3xl font-black text-slate-900 mt-1">대기 대순환 (Ferrel Cell)</h2>
                    <p class="text-slate-600 mt-2">중위도에서의 간접 순환 세포를 제안하여 3세포 모형을 완성했습니다.</p>
                </header>
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 text-center">
                    <div class="relative inline-block w-64 h-64 rounded-full border-4 border-slate-200 bg-blue-50 overflow-hidden shadow-inner">
                        <div class="absolute inset-0 flex flex-col opacity-80">
                            <div class="h-1/6 bg-blue-200 w-full flex items-center justify-center text-[10px] text-blue-800 font-bold">Polar</div>
                            <div class="h-1/3 bg-amber-100 w-full flex items-center justify-center relative group cursor-pointer hover:bg-amber-200 transition">
                                <span class="z-10 text-amber-900 font-bold text-sm">Ferrel Cell</span>
                                <i class="fa-solid fa-arrows-rotate absolute text-4xl text-amber-500/30 animate-spin-slow"></i>
                            </div>
                            <div class="h-1/2 bg-red-100 w-full flex items-center justify-center text-[10px] text-red-800 font-bold pt-4 items-start">Hadley</div>
                        </div>
                    </div>
                    <div class="mt-6 text-left bg-slate-50 p-4 rounded-lg text-sm text-slate-600">
                        <p class="mb-2"><strong class="text-indigo-600">페렐 순환:</strong> 열적으로 간접적인 순환입니다.</p>
                        <p>적도와 극지방의 순환(해들리, 극순환)에 의해 기계적으로 유도되어 반대 방향으로 회전하는 마치 '기어'와 같은 역할을 합니다.</p>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <script>
        // --- 탭 전환 로직 ---
        function switchTab(tabId) {
            // 모든 탭 버튼 비활성화
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active', 'bg-slate-50', 'text-indigo-600'));
            // 선택된 버튼 활성화 (사이드바)
            const activeBtn = document.getElementById('btn-' + tabId);
            if(activeBtn) {
                activeBtn.classList.add('active');
            }

            // 모든 콘텐츠 숨김
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
            // 선택된 콘텐츠 표시
            document.getElementById('tab-' + tabId).classList.remove('hidden');

            // 탭별 초기화 함수 호출
            if (tabId === 'bjerknes') initBjerknes();
            if (tabId === 'rossby') initRossby();
            if (tabId === 'richardson') initRichardson();
            if (tabId === 'charney') drawCharney();
        }

        // --- 1. Bjerknes Logic ---
        function initBjerknes() {
            const canvas = document.getElementById('bjerknesCanvas');
            const ctx = canvas.getContext('2d');
            const slider = document.getElementById('cycloneSlider');
            const text = document.getElementById('cyclone-stage-text');

            function draw() {
                const val = parseInt(slider.value);
                ctx.clearRect(0,0, canvas.width, canvas.height);
                
                const cx = 300, cy = 200;
                
                // 텍스트 업데이트
                if(val < 25) text.innerText = "Stage: 정체 전선 (Stationary)";
                else if(val < 50) text.innerText = "Stage: 파동 형성 (Wave)";
                else if(val < 75) text.innerText = "Stage: 성숙 단계 (Mature)";
                else text.innerText = "Stage: 폐색 단계 (Occluded)";

                // 간단한 전선 그리기 로직
                ctx.lineWidth = 4;
                
                // 저기압 중심 (L)
                ctx.font = "bold 24px sans-serif";
                ctx.fillStyle = "black";
                ctx.fillText("L", cx - 10, cy - 20);

                // 한랭전선 (파랑)
                ctx.strokeStyle = "#2563eb";
                ctx.beginPath();
                const coldAngle = Math.PI + (val / 100) * 1.5; 
                ctx.arc(cx, cy, 120, Math.PI, coldAngle, false); // 단순화된 곡선
                ctx.stroke();

                // 온난전선 (빨강)
                ctx.strokeStyle = "#dc2626";
                ctx.beginPath();
                const warmAngle = (val / 100) * 0.5;
                ctx.moveTo(cx, cy);
                ctx.quadraticCurveTo(cx + 80, cy + (val < 50 ? 0 : 50), cx + 150, cy + (val*0.5));
                ctx.stroke();
            }

            slider.oninput = draw;
            draw();
        }

        // --- 2. Rossby Logic ---
        let rossbyAnimId;
        function initRossby() {
            const canvas = document.getElementById('rossbyCanvas');
            const ctx = canvas.getContext('2d');
            const sliderN = document.getElementById('rossbyN');
            const sliderAmp = document.getElementById('rossbyAmp');
            
            let time = 0;

            function animate() {
                ctx.clearRect(0,0, canvas.width, canvas.height);
                const n = parseInt(sliderN.value);
                const amp = parseInt(sliderAmp.value);
                const cx = canvas.width / 2;
                const cy = canvas.height / 2;
                const radius = 100;

                ctx.beginPath();
                ctx.strokeStyle = "#818cf8"; // indigo-400
                ctx.lineWidth = 3;

                for(let i=0; i<=360; i++) {
                    const angle = (i * Math.PI) / 180;
                    // 로스비 파동 공식 시각화: R + A * sin(n*theta - ct)
                    const r = radius + amp * Math.sin(n * angle - time);
                    const x = cx + r * Math.cos(angle);
                    const y = cy + r * Math.sin(angle);
                    
                    if(i===0) ctx.moveTo(x,y);
                    else ctx.lineTo(x,y);
                }
                ctx.closePath();
                ctx.stroke();

                // 지구 그리기
                ctx.beginPath();
                ctx.strokeStyle = "rgba(255,255,255,0.1)";
                ctx.arc(cx, cy, radius, 0, Math.PI*2);
                ctx.stroke();

                time += 0.02; // 서진(Westward) 하는 위상속도 흉내 (부호에 따라 다름)
                
                if(!document.getElementById('tab-rossby').classList.contains('hidden')){
                    rossbyAnimId = requestAnimationFrame(animate);
                }
            }
            cancelAnimationFrame(rossbyAnimId);
            animate();
        }

        // --- 3. Walker Logic ---
        function setWalker(state) {
            const thermocline = document.getElementById('thermocline');
            const cloud = document.getElementById('cloud-mass');
            const desc = document.getElementById('walker-desc');

            if(state === 'neutral') {
                thermocline.style.clipPath = 'polygon(0 20%, 100% 80%, 100% 100%, 0% 100%)'; // 경사짐
                cloud.style.left = '10%'; // 서쪽
                desc.innerHTML = "<strong>평상시:</strong> 무역풍이 따뜻한 물을 서쪽(인도네시아)으로 밀어냅니다. 서쪽에서 상승기류가 발생합니다.";
            } else if (state === 'lanina') {
                thermocline.style.clipPath = 'polygon(0 10%, 100% 90%, 100% 100%, 0% 100%)'; // 급격한 경사
                cloud.style.left = '5%'; // 더 서쪽
                desc.innerHTML = "<strong>라니냐:</strong> 무역풍이 평소보다 강해집니다. 동태평양 용승이 강화되어 수온이 차가워집니다.";
            } else if (state === 'elnino') {
                thermocline.style.clipPath = 'polygon(0 50%, 100% 50%, 100% 100%, 0% 100%)'; // 평평함
                cloud.style.left = '45%'; // 중앙으로 이동
                desc.innerHTML = "<strong>엘니뇨:</strong> 무역풍이 약해집니다. 따뜻한 물이 동쪽으로 이동하며 비구름도 중앙태평양으로 이동합니다.";
            }
        }

        // --- 4. Richardson Logic ---
        function initRichardson() {
            const grid = document.getElementById('forecast-grid');
            if(grid.innerHTML.trim() !== "") return; // 이미 생성됐으면 패스

            // 5x5 격자 생성
            for(let i=0; i<25; i++) {
                const cell = document.createElement('div');
                cell.className = 'h-12 bg-slate-100 rounded flex items-center justify-center font-mono text-xs font-bold text-slate-400 transition-colors duration-500';
                cell.innerText = Math.floor(Math.random() * 20) + 10; // 초기 온도/압력값 흉내
                cell.id = `cell-${i}`;
                grid.appendChild(cell);
            }
        }

        function stepRichardson() {
            for(let i=0; i<25; i++) {
                const cell = document.getElementById(`cell-${i}`);
                const currentVal = parseInt(cell.innerText);
                // 간단한 변화 시뮬레이션 (-2 ~ +2)
                const change = Math.floor(Math.random() * 5) - 2;
                const newVal = currentVal + change;
                
                cell.innerText = newVal;
                
                // 시각적 피드백
                cell.style.backgroundColor = newVal > 20 ? '#fee2e2' : '#e0f2fe'; // 붉거나 푸르게
                cell.style.color = newVal > 20 ? '#991b1b' : '#075985';
            }
        }

        // --- 5. Charney Logic (Simple Graph) ---
        function drawCharney() {
            const canvas = document.getElementById('charneyCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0,0, canvas.width, canvas.height);
            
            ctx.beginPath();
            ctx.strokeStyle = "#4f46e5";
            ctx.lineWidth = 3;

            // Charney Growth Rate Curve 모양 흉내
            // x: Wavenumber, y: Growth Rate
            // 특정 파장에서 피크를 찍고 0으로 떨어지는 모양
            
            ctx.moveTo(0, 250);
            for(let x=0; x<=600; x+=5) {
                // 가우시안 분포와 유사한 곡선
                const normalizedX = (x - 300) / 100;
                const y = 250 - (200 * Math.exp(-normalizedX * normalizedX)); 
                ctx.lineTo(x, y);
            }
            ctx.stroke();

            // 축 그리기
            ctx.font = "12px sans-serif";
            ctx.fillStyle = "#64748b";
            ctx.fillText("Wavenumber (k)", 260, 240);
            ctx.fillText("Growth Rate (σ)", 10, 20);
        }

        // 초기 실행
        initBjerknes();

    </script>
</body>
</html>
